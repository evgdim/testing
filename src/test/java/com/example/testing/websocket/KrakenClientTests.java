package com.example.testing.websocket;

import com.example.testing.websocket.model.OrderBookUpdate;
import org.junit.Test;
import org.testcontainers.shaded.com.fasterxml.jackson.databind.ObjectMapper;

import java.io.IOException;
import java.util.Optional;

import static org.assertj.core.api.Assertions.assertThat;

public class KrakenClientTests {
//    @Test
//    public void testMapper() {
//        String fullUpdate = "[119930880,{\"as\":[[\"67600.20000\",\"5.84813358\",\"1717060077.563606\"],[\"67600.30000\",\"0.00082041\",\"1717060074.010724\"],[\"67600.40000\",\"0.00104233\",\"1717060010.894725\"],[\"67600.50000\",\"0.00073136\",\"1717060008.523527\"],[\"67600.60000\",\"0.00101255\",\"1717060008.001503\"],[\"67600.70000\",\"0.00142670\",\"1717060044.402445\"],[\"67600.80000\",\"1.78482455\",\"1717060077.786229\"],[\"67600.90000\",\"1.47927093\",\"1717059975.242301\"],[\"67605.30000\",\"0.00010000\",\"1717060077.398985\"],[\"67605.60000\",\"0.68717846\",\"1717059989.473024\"]],\"bs\":[[\"67600.10000\",\"0.15560256\",\"1717059986.277923\"],[\"67595.00000\",\"0.04630000\",\"1717060077.642087\"],[\"67591.10000\",\"0.92032486\",\"1717060076.938666\"],[\"67590.70000\",\"0.09607700\",\"1717060078.262559\"],[\"67590.10000\",\"0.07690000\",\"1717060077.622666\"],[\"67586.50000\",\"0.00010000\",\"1717060059.673398\"],[\"67586.00000\",\"0.00010000\",\"1717060075.072394\"],[\"67585.30000\",\"0.00215421\",\"1717060078.559814\"],[\"67585.20000\",\"0.12005177\",\"1717060078.309776\"],[\"67585.10000\",\"1.47961434\",\"1717060078.306689\"]]},\"book-10\",\"XBT/USD\"]";
//        Optional<OrderBookUpdate> orderBookUpdate = KrakenClient.ResponseMapper.mapResponse(fullUpdate);
//        assertThat(orderBookUpdate.isPresent()).isEqualTo(true);
//        assertThat(orderBookUpdate.get().getChannelName()).isEqualTo("book-10");
//    }

    @Test
    public void testFullUpdateMapping() throws IOException {
        String fullUpdate = "[119930880,{\"as\":[[\"67600.20000\",\"5.84813358\",\"1717060077.563606\"],[\"67600.30000\",\"0.00082041\",\"1717060074.010724\"],[\"67600.40000\",\"0.00104233\",\"1717060010.894725\"],[\"67600.50000\",\"0.00073136\",\"1717060008.523527\"],[\"67600.60000\",\"0.00101255\",\"1717060008.001503\"],[\"67600.70000\",\"0.00142670\",\"1717060044.402445\"],[\"67600.80000\",\"1.78482455\",\"1717060077.786229\"],[\"67600.90000\",\"1.47927093\",\"1717059975.242301\"],[\"67605.30000\",\"0.00010000\",\"1717060077.398985\"],[\"67605.60000\",\"0.68717846\",\"1717059989.473024\"]],\"bs\":[[\"67600.10000\",\"0.15560256\",\"1717059986.277923\"],[\"67595.00000\",\"0.04630000\",\"1717060077.642087\"],[\"67591.10000\",\"0.92032486\",\"1717060076.938666\"],[\"67590.70000\",\"0.09607700\",\"1717060078.262559\"],[\"67590.10000\",\"0.07690000\",\"1717060077.622666\"],[\"67586.50000\",\"0.00010000\",\"1717060059.673398\"],[\"67586.00000\",\"0.00010000\",\"1717060075.072394\"],[\"67585.30000\",\"0.00215421\",\"1717060078.559814\"],[\"67585.20000\",\"0.12005177\",\"1717060078.309776\"],[\"67585.10000\",\"1.47961434\",\"1717060078.306689\"]]},\"book-10\",\"XBT/USD\"]";
        ObjectMapper objectMapper = new ObjectMapper();
        var value = objectMapper.readValue(fullUpdate, OrderBookUpdate.class);
        System.out.println(value);
    }

    @Test
    public void testPartialUpdateMapping() throws IOException {
        String partialUpdate = "[119930880,{\"a\":[[\"68269.20000\",\"0.00000000\",\"1717143965.367577\"],[\"68273.60000\",\"0.14625429\",\"1717143962.156583\",\"r\"]],\"c\":\"1765979671\"},\"book-10\",\"XBT/USD\"]";
        ObjectMapper objectMapper = new ObjectMapper();
        var value = objectMapper.readValue(partialUpdate, OrderBookUpdate.class);
        System.out.println(value);
    }
}
